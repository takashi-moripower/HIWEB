<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">


<sqlMap namespace="tuchi">
	<resultMap id="tuchiResult"
		class="logistics.system.project.tuchi.Entity.TuchiEntity">
		<result column="TUCHI_ID" jdbcType="INTEGER" property="tuchiId" />
		<result column="USER_ID" jdbcType="CHAR" property="userId" />
		<result column="NINUSI_CD" jdbcType="CHAR" property="ninusiCd" />
		<result column="PREF_CD" jdbcType="CHAR" property="prefCd" />
		<result column="DATE_START" jdbcType="TIMESTAMP" property="dateStart" />
		<result column="DATE_END" jdbcType="TIMESTAMP" property="dateEnd" />
		<result column="TITLE" jdbcType="VARCHAR" property="title" />
		<result column="MAIL_COUNT" jdbcType="INTEGER" property="mailCount" />
		<result column="MAIL_COUNT_DAY" jdbcType="INTEGER" property="mailCountDay" />
	</resultMap>

	<sql id="Base_Column_List">
		TUCHI_ID,
		USER_ID,
		NINUSI_CD,
		PREF_CD,
		DATE_START,
		DATE_END,
		TITLE,
		MAIL_COUNT,
		MAIL_COUNT_DAY
	</sql>

	<select id="getTuchiByCd" parameterClass="java.lang.Integer"
		resultMap="tuchiResult">
		select
		<include refid="Base_Column_List" />
		from t_tuchi
		where TUCHI_ID = #value#
	</select>

	<select id="getTuchiByUser" parameterClass="java.lang.String"
		resultMap="tuchiResult">
		select
		<include refid="Base_Column_List" />
		from t_tuchi
		<dynamic>
			<isNotEmpty>
				where USER_ID = #value#
			</isNotEmpty>
		</dynamic>
	</select>
	<select id="getNextTuchiId" resultClass="java.lang.Integer">
		SELECT
			MAX(TUCHI_ID) + 1
		FROM T_TUCHI
	</select>
	<select id="getTruckOpByTuchiCd" parameterClass="java.lang.Integer" resultClass="java.lang.String">
		SELECT
			OP_CD
		FROM T_TRUCK_OP_TUCHI
		WHERE TUCHI_ID = #value#
	</select>

	<update id="updateTuchi" parameterClass="logistics.system.project.tuchi.Entity.TuchiEntity">
		UPDATE
		T_TUCHI
		SET
			TITLE =	#title#,
			PREF_CD = #prefCd#,
			DATE_START = #dateStart#,
			DATE_END = #dateEnd#
		WHERE TUCHI_ID = #tuchiId#
		AND USER_ID = #userId#
	</update>
	<insert id="insertTuchi" parameterClass="logistics.system.project.tuchi.Entity.TuchiEntity">
			INSERT
			INTO T_TUCHI (
				TUCHI_ID,
				USER_ID,
				TITLE,
				PREF_CD,
				DATE_START,
				DATE_END
			)
			VALUES(
				#tuchiId#,
				#userId#,
				#title#,
				#prefCd#,
				#dateStart#,
				#dateEnd#
			)
	</insert>
	<insert id="linkTruckOpTuchi" parameterClass="java.util.Map">
		INSERT
			INTO T_TRUCK_OP_TUCHI(
				TUCHI_ID,
				OP_CD
			)
			VALUES(
				#tuchiId#,
				#opCd#
			)
	</insert>
	<delete id="unlinkTruckOpTuchi" parameterClass="java.util.Map">
		DELETE
			FROM T_TRUCK_OP_TUCHI
			WHERE (
				TUCHI_ID = #tuchiId# AND
				OP_CD IN ( $opList$ )
			)
	</delete>
</sqlMap>
